# SSH keys

- SSH keys can serve as a means of identifying yourself to an SSH server using public-key cryptography and challenge-response authentication.

- The major advantage of key-based authentication is that, in contrast to password authentication, it is not prone to brute-force attacks, and you do not expose valid credentials if the server has been compromised.

- Furthermore, SSH key can be more convenient than the more traditional password authentication.

- When used with a program known as an SSH agent, SSH keys can allow you to connect to a server, or multiple servers, without having to remember or enter your password for each system.

- This article assumes you already have a basic understanding of theSecure Shell protocol and have installed the `openssh` package.

## 1 Background

- SSH keys are always generated in pairs with one known as the private key and the otheras the public key.

- The private key is known only to you and it should be safely guarded.

- By contrast, the public key can be shared freely with any SSH server to which you wish to connect.

- If an SSH server has your public key on file and sees you requesting a connection, it uses your public key to construct and send you a challenge.

- This challenge is an encrypted message and it must be met with the appropriate response before the server will grant you access.

- What makes this coded message particularly secure is that it can only be understood by the private key holder.

- While the public key can be used to encrypt the message, it cannot be used to decrypt that very same message.

- Only you, the holder of the private key, will be able to correctly understand the challenge and produce the proper response.

- This challenge-response phrase happens behind the scenes and is invisible to the user.

- As long as you hold the private key, which is typically stored in the `~/.ssh/` directory, your SSH client should be able to reply with the appropriate response to the server.

- A private key is a guarded secret and as such it is advisable to store it on disk in an encrypted form.

- When encrypted private is required, a passphrase must first be entered in order to decrypt it.

- While this might superficially appear as though you are providing a login password to the SSH server, the passphrase is only used to decrypt the private key on the local system.

- The passphrase is not transmitted over the network.

## 2 Generating an SSH key pair

- An SSH key pair can be generated by running the `ssh-keygen` command, see the `ssh-keygen(1)` man page for what is "*generally considered sufficient*" and should be compatible with virtually all clients and servers:

```sh
$ ssh-keygen
```

- The randomart image was introduced in OpenSSH 5.1 as an easier means of visually identifying the key fingerprint.

- You can also add an optional commend field to the public key with the `-C` switch, to more easily identify it in places such as `~/.ssh/known_hosts`, `~/.ssh/authorized_keys` and `ssh-add -L` output.

- For example:

    ```sh
    $ ssh-keygen -C "$(whoami)@$(uname -n)-$(date -I)"
    $$$
    ```

    - will add a comment saying which user created the key on which machinee and when.

### 2.1 Choosing the authentication key type

- OpenSSH supports several signing algorithms (for authentication keys) which can be divided in two groups depending on the mathematical properties they exploit:

    1. Ed25519 and ECDSA, which rely on the elliptic curve discrete logarithm problem.

    2. RSA, which relies on the practical difficulty of factoring the product of two large prime numbers.

- Elliptic curve cryptography (ECC) algorithms are a more recent addition to public key cryptosystems.

- One of their main advantages is their ability to provide the same level of security with smaller keys, which makes for less computationally intensive operations and reduced storage and transmission requirements.

- RSA keys will give you the greatest portability, while Ed25519 will give you the best security but requires recent versions of client & server.

- ECDSA is likely more compatible than Ed25519 (though still less than RSA), but suspicions exist about its security (see below).

#### 2.1.1 Ed25519

- Ed25519 was introduced in OpenSSH 6.5 of January 2014: "Ed25519 is an elliptic curve signature scheme that offers better security than ECDSA and DSA and good performance".

- Its main strengths are its speed, its constant-time run time (and resistance against side-channel attacks), and its lack of nebulous hard-coded constants.

- It is already implemented in many applications and libraries and is the default key exchange algorithm (which is different from key *signature*) in OpenSSH.

### 2.2 Choosing the key location and passphrase

#### 2.2.1 Changing the private key's passphrase without changing the key

- This can also be used to change the password encoding format to the new standard.

```sh
$ ssh-keygen -f ~/.ssh/id_rsa -p
```

#### 2.2.2 Managing multiple keys

- If you have multiple SSH identities, you can set different keys to be used for different hosts or remote users by using the `Match` and `IdentityFile` directives in your configuration:

- `~/.ssh/config`

    ```
    Match host=SERVER1
       IdentitiesOnly yes
       IdentityFile ~/.ssh/id_rsa_IDENTITY1

    Match host=SERVER2,SERVER3
       IdentitiesOnly yes
       IdentityFile ~/.ssh/id_ed25519_IDENTITY2
    ```

- See `ssh_config(5)` for full description of these options.

## 4 SSH agents

- If your private key is encrypted with a passphrase, this passphrase must be entered every time you attempt to connect to an SSH server using public-key authentication.

- An SSH agent is a program which caches your decrypted private keys and provides them to SSH client programs on your behalf.

- In this arrangement, you must only provide your passphrase once, when adding your private key to the agent's cache.

- An agent is typically configured to run automatically upon login and persist for the duration of your login session.

- A variety of agents, front-ends, and configurations exist to achieve this effect.

- This section provides an overview of a number of different solutions which can be adapted to meet your specific needs.
